<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ´Ø®ÙŠØµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        pre { background: #f8f9fa; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ” ØªØ´Ø®ÙŠØµ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
    
    <div class="debug-section">
        <h3>1. ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <button onclick="loadDatabase()">ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="loadResult"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. ØªØ­Ù„ÙŠÙ„ ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
        <button onclick="analyzeData()">ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <div id="analyzeResult"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h3>
        <input type="text" id="searchInput" placeholder="Ø§ÙƒØªØ¨ Ù„Ù„Ø¨Ø­Ø«..." value="panadol">
        <button onclick="directSearch()">Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø±</button>
        <div id="searchResult"></div>
    </div>

    <script>
        let rawData = null;
        
        async function loadDatabase() {
            const result = document.getElementById('loadResult');
            result.innerHTML = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
            
            try {
                const response = await fetch('./products-db.json');
                if (response.ok) {
                    rawData = await response.json();
                    result.innerHTML = `âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­<br>Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${typeof rawData}<br>Ù‡Ù„ Ù‡ÙŠ Ù…ØµÙÙˆÙØ©: ${Array.isArray(rawData)}`;
                    result.className = 'debug-section success';
                } else {
                    result.innerHTML = `âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ (${response.status})`;
                    result.className = 'debug-section error';
                }
            } catch (error) {
                result.innerHTML = `âŒ Ø®Ø·Ø£: ${error.message}`;
                result.className = 'debug-section error';
            }
        }
        
        function analyzeData() {
            const result = document.getElementById('analyzeResult');
            
            if (!rawData) {
                result.innerHTML = 'âŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹';
                result.className = 'debug-section error';
                return;
            }
            
            try {
                let analysis = `<h4>ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</h4>`;
                analysis += `<p><strong>Ù†ÙˆØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</strong> ${typeof rawData}</p>`;
                analysis += `<p><strong>Ù‡Ù„ Ù‡ÙŠ Ù…ØµÙÙˆÙØ©:</strong> ${Array.isArray(rawData)}</p>`;
                
                if (Array.isArray(rawData)) {
                    analysis += `<p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±:</strong> ${rawData.length}</p>`;
                    
                    if (rawData.length > 0) {
                        const sample = rawData[0];
                        const keys = Object.keys(sample);
                        
                        analysis += `<p><strong>Ø¹Ø¯Ø¯ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙÙŠ Ø§Ù„Ø¹ÙŠÙ†Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰:</strong> ${keys.length}</p>`;
                        analysis += `<p><strong>Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…ØªØ§Ø­Ø©:</strong></p>`;
                        analysis += `<ul>`;
                        keys.forEach(key => {
                            const value = sample[key];
                            const type = typeof value;
                            const preview = String(value).substring(0, 50) + (String(value).length > 50 ? '...' : '');
                            analysis += `<li><strong>${key}</strong> (${type}): ${preview}</li>`;
                        });
                        analysis += `</ul>`;
                    }
                } else {
                    analysis += `<p><strong>Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ÙƒØ§Ø¦Ù†:</strong></p>`;
                    const keys = Object.keys(rawData);
                    analysis += `<ul>`;
                    keys.forEach(key => {
                        const value = rawData[key];
                        const type = typeof value;
                        analysis += `<li><strong>${key}</strong> (${type}): ${Array.isArray(value) ? `${value.length} Ø¹Ù†ØµØ±` : String(value).substring(0, 50)}</li>`;
                    });
                    analysis += `</ul>`;
                }
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† panadol
                let panadolItems = [];
                if (Array.isArray(rawData)) {
                    panadolItems = rawData.filter(item => {
                        const searchableText = JSON.stringify(item).toLowerCase();
                        return searchableText.includes('panadol');
                    });
                } else {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒØ§Ø¦Ù†ØŒ Ù†Ø¨Ø­Ø« ÙÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚ÙŠÙ…
                    const searchInObject = (obj) => {
                        const results = [];
                        for (const key in obj) {
                            if (typeof obj[key] === 'object' && obj[key] !== null) {
                                results.push(...searchInObject(obj[key]));
                            } else if (typeof obj[key] === 'string' && obj[key].toLowerCase().includes('panadol')) {
                                results.push(obj);
                            }
                        }
                        return results;
                    };
                    panadolItems = searchInObject(rawData);
                }
                
                analysis += `<h4>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† "panadol":</h4>`;
                analysis += `<p>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${panadolItems.length} Ø¹Ù†ØµØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ "panadol"</p>`;
                
                if (panadolItems.length > 0) {
                    analysis += `<h5>Ø£Ù…Ø«Ù„Ø©:</h5>`;
                    panadolItems.slice(0, 3).forEach((item, index) => {
                        analysis += `<details><summary>Ø¹Ù†ØµØ± ${index + 1}</summary><pre>${JSON.stringify(item, null, 2)}</pre></details>`;
                    });
                }
                
                result.innerHTML = analysis;
                result.className = 'debug-section success';
                
            } catch (error) {
                result.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ${error.message}`;
                result.className = 'debug-section error';
            }
        }
        
        function directSearch() {
            const result = document.getElementById('searchResult');
            const query = document.getElementById('searchInput').value.toLowerCase();
            
            if (!rawData) {
                result.innerHTML = 'âŒ ÙŠØ±Ø¬Ù‰ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„Ø§Ù‹';
                result.className = 'debug-section error';
                return;
            }
            
            if (!query) {
                result.innerHTML = 'âŒ ÙŠØ±Ø¬Ù‰ ÙƒØªØ§Ø¨Ø© Ù†Øµ Ù„Ù„Ø¨Ø­Ø«';
                result.className = 'debug-section error';
                return;
            }
            
            try {
                let results = [];
                
                if (Array.isArray(rawData)) {
                    results = rawData.filter(item => {
                        const searchableText = JSON.stringify(item).toLowerCase();
                        return searchableText.includes(query);
                    });
                } else {
                    // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„ÙƒØ§Ø¦Ù†
                    const searchInObject = (obj) => {
                        const results = [];
                        for (const key in obj) {
                            if (typeof obj[key] === 'object' && obj[key] !== null) {
                                results.push(...searchInObject(obj[key]));
                            } else if (typeof obj[key] === 'string' && obj[key].toLowerCase().includes(query)) {
                                results.push(obj);
                            }
                        }
                        return results;
                    };
                    results = searchInObject(rawData);
                }
                
                if (results.length > 0) {
                    let output = `<h4>ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${results.length} Ù†ØªÙŠØ¬Ø©:</h4>`;
                    results.slice(0, 5).forEach((item, index) => {
                        const name = item.name || item.productName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        const code = item.code || item.id || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
                        output += `<p><strong>${index + 1}.</strong> ${name} (${code})</p>`;
                    });
                    
                    if (results.length > 5) {
                        output += `<p>... Ùˆ ${results.length - 5} Ù†ØªÙŠØ¬Ø© Ø£Ø®Ø±Ù‰</p>`;
                    }
                    
                    result.innerHTML = output;
                    result.className = 'debug-section success';
                } else {
                    result.innerHTML = `âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù†ØªØ§Ø¦Ø¬ Ù„Ù„Ø¨Ø­Ø«: "${query}"`;
                    result.className = 'debug-section error';
                }
                
            } catch (error) {
                result.innerHTML = `âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨Ø­Ø«: ${error.message}`;
                result.className = 'debug-section error';
            }
        }
    </script>
</body>
</html> 